---
layout: post
title:  "linux下adsl拔号与共享上网"
date:   2007-05-24 16:16:30
categories: 默认分类
tags:
---

* content
{:toc}

引自：http://blog.chinaunix.net/u/17549/showart.php?id=188498     多台电脑通过ADSL同时上网，如果有路由，那就太简单了。  但是，如果没路由只有交换机怎么办呢？一般有两种方法。  1、用双网卡（一个接内网，一个接外网）的机器装代理服务器软件（windows下有winGet等）来完成，但这种方法要两块网卡（浪费）,同时还要装代理软件（烦，而且还会被打盗版）。  2、通过共享拔号连接来解决，这种方法很简单且不需要其它的软件。  对于windows下的第二种方法的实现网上有很文章且很简单，在此不作阐述。      下面就我在linux(在centOS4.4,rhel as 4,fc5下测试通过)下如何通过adsl拔号与共享上网作一个简单的记录，希望对新手有所帮助。  1、拔号上网  1.1拔号软件      linux下的拔号软件很多，但比较好的是rp-pppoe,一般linux系统会自带拔号软件，如果你没装，请自己到google去找一个来装上。  1.2拔号设置      切换为root用户,只有root才能配置。      $ su      Password:      # /sbin/adsl-setup      按提示设置用户名、密码、DNS、及其它相关信息，下面是我的参考配置:  Welcome to the ADSL client setup.  First, I will run some checks on  your system to make sure the PPPoE client is installed properly...  The following DSL config was found on your system:    Device:      Name:    ppp0         DSLppp0  Please enter the device if you want to configure the present DSL config  (default ppp0) or enter 'n' if you want to create a new one:  LOGIN NAME  Enter your Login Name (default xyn0699647):  INTERFACE  Enter the Ethernet interface connected to the ADSL modem  For Solaris, this is likely to be something like /dev/hme0.  For Linux, it will be ethX, where 'X' is a number.  (default eth0):  Do you want the link to come up on demand, or stay up continuously?  If you want it to come up on demand, enter the idle time in seconds  after which the link should be dropped.  If you want the link to  stay up permanently, enter 'no' (two letters, lower-case.)  NOTE: Demand-activated links do not interact well with dynamic IP  addresses.  You may have some problems with demand-activated links.  Enter the demand value (default no):  DNS  Please enter the IP address of your ISP's primary DNS server.  If your ISP claims that 'the server will provide dynamic DNS addresses',  enter 'server' (all lower-case) here.  If you just press enter, I will assume you know what you are  doing and not modify your DNS setup.  Enter the DNS information here:  PASSWORD  Please enter your Password:  Please re-enter your Password:  USERCTRL  Please enter 'yes' (two letters, lower-case.) if you want to allow  normal user to start or stop DSL connection (default yes):  FIREWALLING  Please choose the firewall rules to use.  Note that these rules are  very basic.  You are strongly encouraged to use a more sophisticated  firewall setup; however, these will provide basic security.  If you  are running any servers on your machine, you must choose 'NONE' and  set up firewalling yourself.  Otherwise, the firewall rules will deny  access to all standard servers like Web, e-mail, ftp, etc.  If you  are using SSH, the rules will block outgoing SSH connections which  allocate a privileged source port.  The firewall choices are:  0 - NONE: This script will not set any firewall rules.  You are responsible            for ensuring the security of your machine.  You are STRONGLY            recommended to use some kind of firewall rules.  1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation  2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway                  for a LAN  Choose a type of firewall (0-2):  Please enter a number from 0 to 2  The firewall choices are:  0 - NONE: This script will not set any firewall rules.  You are responsible            for ensuring the security of your machine.  You are STRONGLY            recommended to use some kind of firewall rules.  1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation  2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway                  for a LAN  Choose a type of firewall (0-2): 0  Start this connection at boot time  Do you want to start this connection at boot time?  Please enter no or yes (default no):  ** Summary of what you entered **  Ethernet Interface: eth0  User name:          xyn0699647  Activate-on-demand: No  DNS:                Do not adjust  Firewalling:        NONE  User Control:       yes  Accept these settings and adjust configuration files (y/n)? y  Adjusting /etc/sysconfig/network-scripts/ifcfg-ppp0  Adjusting /etc/ppp/chap-secrets and /etc/ppp/pap-secrets    (But first backing it up to /etc/ppp/chap-secrets.bak)    (But first backing it up to /etc/ppp/pap-secrets.bak)  Congratulations, it should be all set up!  Type '/sbin/ifup ppp0' to bring up your xDSL link and '/sbin/ifdown ppp0'  to bring it down.  Type '/sbin/adsl-status /etc/sysconfig/network-scripts/ifcfg-ppp0'  to see the link status.  1.3拔号连接与断开      输入 '/sbin/ifup ppp0' 进行拔号连接戓'/sbin/ifdown ppp0'断开拔号连接。      至此，如果一切正常，你就可以正常网上冲浪！  2、共享上网      通过上面的设置，你只能自己上网，要想其它电脑共享linux的连接上网,需要作如下的设置。  LINUX网络设置：  内网IP：192.168.0.1  子网掩码：255.255.255.0  网关：192.168.0.1  DNS：根据各地的网络服务商不同，云南昆明的是 202.98.160.68  注：要使设置生效，请先停止网卡，然后再激活。  其它的机器的设置只要保证与linux机器在一个网段并且网关设置为192.168.0.1就可以了，如：  192.168.0.2  255.255.255.0  192.168.0.1  DNS和主机一样。  用你喜欢的编辑器(如vi,gedit等)打开LINUX主机的/etc/rc.d/rc.local  在最后补上如下内容：  echo "1" > /proc/sys/net/ipv4/ip_forward  /sbin/modprobe ip_nat_ftp  /sbin/modprobe ip_conntrack  /sbin/modprobe ip_conntrack_ftp  /sbin/modprobe ip_conntrack_irc  /sbin/iptables -t nat -A POSTROUTING -o ppp0 -s 192.168.0.1/24 -j MASQUERADE  运行一下rc.local      /etc/rc.d/rc.local  重新拔号，这样linux下的共享连接就设置OK了！
        
